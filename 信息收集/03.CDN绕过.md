# CDN绕过

并不一定能找到源IP并在外部直接访问，它可能隐藏于CDN之后并且对访问设置了IP白名单

### CDN
```text
如果目标站点使用了CDN，一般目标域名会被设置为另一个域名的cname记录，负责解析那个cname记录的DNS会依据负载均衡或LDNS的地理位置或其他算法返回给LDNS一个或多个IP，LDNS只会交给浏览器一个IP。

需要绕开CDN得到真实服务器的IP地址，因为对CDN发起攻击是没有意义的，得到的这个IP的几种情况：
    是个服务器但不一定就只有一个网站
    是个反向代理，真实服务器在内网

不管怎样，与这个站相关的操作都要用域名进行，与服务器相关的用IP进行，因为可能一个服务器上配置了多个站点

多站点技术-虚拟主机
    多个网站位于同台服务器，配置不同域名指向不同目录
多站点技术-反向代理
    多个网站位于内网中的其他多个服务器，配置不同域名指向不同内网服务器
```

### CDN判定和绕过
```text
如果host解析过程中有cname记录，多半有cdn
    host xxx.com

多地DNS解析A记录
    平台：https://www.itdog.cn/dns/
    手动：host -t a 世界各地DNS：http://ip.yqie.com/dns.htm

找只有1条结果且都相同的那个IP
    如果各地解析得到的都是一个相同的IP列表，尝试通过IP归属地找到离公司城市最近的IP
    如果目标域名不是泛解析，找它业务量不大的子域名的ip，比如邮箱：尝试查询其mx和在txt记录里的的spf，拿到疑似同域名的邮箱服务器域名，重复上述过程。但也不一定就和目标是同一台服务器
    如果都猜不到，我也不知道了🤷‍♂️，比如douban.com

寻找目标站是否提供了主动链接外部站点的服务，比如通过url上传图片或发送邮件等，让其从自己的主机上下载内容，监听其来源IP，邮件源码会包含邮件服务器的IP

得到的这个ip填入hosts文件，确保解析dns的工具或浏览器们清除历史缓存以确保解析修改过的hosts文件，浏览器访问以验证这个IP是否可以访问目标站。
```

### F5 BIG-IP LTM Cookie保持机制解码IP
```text
· 标志：Set-Cookie: BIGipServer.....
· 利用工具：https://github.com/ezelf/f5_cookieLeaks.git
```

### app渗透
```text
目标家的app的请求地址是否泄露真实IP
```

### 同ip站查询
```text
平台查询：https://www.webscan.cc
```